### ═══════════════════════════════════════════════════════════════
### GraphQL ERP - Full API Test Suite
### ═══════════════════════════════════════════════════════════════
### Run in order. At each step, copy the returned IDs
### and paste them into the corresponding placeholder
### in the next step.
###
### Placeholders:
###   {{apiKey}}         = Bootstrap API key from console output
###   {{token}}          = accessToken returned from login
###   {{tenantId}}       = id returned from createTenant
###   {{companyId}}      = id returned from createCompany
###   {{departmentId}}   = id returned from createDepartment
###   {{employeeId}}     = id returned from createEmployee
###   {{bpId}}           = id returned from createBusinessPartner
###   {{warehouseId}}    = id returned from createWarehouse
###   {{categoryId}}     = id returned from createCategory
###   {{subCategoryId}}  = sub-category id
###   {{itemId}}         = id returned from createItem
###   {{stockLevelId}}   = id returned from reserveStock
###   {{movementId}}     = id returned from recordStockMovement
###   {{salesOrderId}}   = id returned from createSalesOrder
###   {{salesLineId}}    = line id returned from addSalesOrderLine
###   {{deliveryOrderId}}= id returned from createDeliveryOrder
###   {{doLineId}}       = delivery order line id
###   {{shipmentId}}     = id returned from createShipment
###   {{shipmentLineId}} = shipment line id
###   {{shipmentReturnId}} = id returned from createShipmentReturn
###   {{revenueAccountId}} = id returned from createAccount (Revenue)
###   {{arAccountId}}      = id returned from createAccount (AR)
###   {{taxAccountId}}     = id returned from createAccount (Tax)
###   {{cashAccountId}}    = id returned from createAccount (Cash)
###   {{expenseAccountId}} = id returned from createAccount (Expense)
###   {{periodId}}         = id returned from createAccountingPeriod
###   {{journalEntryId}}   = id returned from createJournalEntry
###   {{salesInvoiceId}}   = id returned from createSalesInvoice
###   {{paymentId}}        = id returned from createPayment
###   {{creditNoteId}}     = id returned from createCreditNote
###   {{expenseId}}        = id returned from createExpense
### ═══════════════════════════════════════════════════════════════


### ┌──────────────────────────────────────────────────────────────┐
### │  0. BOOTSTRAP - Paste the API key from console output        │
### │     into the apiKey variable below                           │
### └──────────────────────────────────────────────────────────────┘

@apiKey = 9404f866-b80e-4539-81db-9bc5284a2d05

### 1.1 Create Tenant
POST http://localhost:8080/graphql
Content-Type: application/json
X-API-KEY: {{apiKey}}

{
  "query": "mutation { createTenant(input: { name: \"Test Tenant\", code: \"TST\" }) { id name code authMode } }"
}

> {%
    client.global.set("tenantId", response.body.data.createTenant.id);
%}

### 1.2 Get All Tenants
POST http://localhost:8080/graphql
Content-Type: application/json
X-API-KEY: {{apiKey}}
X-TENANT: TST

{
  "query": "{ tenants { id name code authMode companies { id name } } }"
}

### 1.3 Get Tenant by ID
POST http://localhost:8080/graphql
Content-Type: application/json
X-API-KEY: {{apiKey}}
X-TENANT: TST

{
  "query": "{ tenant(id: \"{{tenantId}}\") { id name code authMode companies { id name } } }"
}

### 1.4 Update Auth Mode
POST http://localhost:8080/graphql
Content-Type: application/json
X-API-KEY: {{apiKey}}

{
  "query": "mutation { updateTenantAuthMode(input: { tenantId: \"{{tenantId}}\", authMode: \"LOCAL\" }) { id authMode } }"
}


### 2.1 Register (uses API key + tenant code for bootstrap)
POST http://localhost:8080/graphql
Content-Type: application/json
X-API-KEY: {{apiKey}}
X-TENANT: TST

{
  "query": "mutation { register(input: { username: \"admin\", password: \"Admin123!\" }) { userId username } }"
}

> {%
    client.global.set("userId", response.body.data.register.userId);
%}

### 2.2 Get Roles (via API key — GENERAL:ADMIN)
POST http://localhost:8080/graphql
Content-Type: application/json
X-API-KEY: {{apiKey}}
X-TENANT: TST

{
  "query": "{ roles { id name permissions { id module action key } } }"
}

> {%
    var roles = response.body.data.roles;
    for (var i = 0; i < roles.length; i++) {
        if (roles[i].name === "ADMIN") {
            client.global.set("adminRoleId", roles[i].id);
        }
    }
%}

### 2.3 Get All Permissions
POST http://localhost:8080/graphql
Content-Type: application/json
X-API-KEY: {{apiKey}}
X-TENANT: TST

{
  "query": "{ permissions { id module action key } }"
}

### 2.4 Assign ADMIN role to user (via API key)
POST http://localhost:8080/graphql
Content-Type: application/json
X-API-KEY: {{apiKey}}
X-TENANT: TST

{
  "query": "mutation { assignRoleToUser(input: { userId: \"{{userId}}\", roleId: \"{{adminRoleId}}\" }) }"
}

### 2.5 Login (now user has ADMIN role with all permissions)
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST

{
  "query": "mutation { login(input: { username: \"admin\", password: \"Admin123!\" }) { accessToken refreshToken expiresAt } }"
}

> {%
    client.global.set("token", response.body.data.login.accessToken);
%}

###
@token = eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJhZjNmZTcwZi01YTJjLTRhMmUtODBlZC03ZjlmZGJmNmIwNTQiLCJ0ZW5hbnQiOiJkMzZkN2VmZi01N2NiLTRmNzYtODBjNy04NmM0ZmQwOGRjODgiLCJ1c2VybmFtZSI6ImFkbWluIiwicm9sZXMiOlsiNTNkMDBjYjUtMzZlNy1hNDkxLTFkMjQtMzc1MTQ2MGQ2NGI0Il0sInR5cGUiOiJhY2Nlc3MiLCJwZXJtaXNzaW9ucyI6WyJTQUxFU19PUkRFUjpDT05GSVJNIiwiVEFYOlVQREFURSIsIkNPTVBBTlk6UkVBRCIsIlBBWU1FTlRfVEVSTTpDUkVBVEUiLCJTQUxFU19PUkRFUjpDUkVBVEUiLCJVTklUOlVQREFURSIsIkJVU0lORVNTX1BBUlRORVI6VVBEQVRFIiwiQlVTSU5FU1NfUEFSVE5FUjpERUxFVEUiLCJFTVBMT1lFRTpVUERBVEUiLCJTVE9DS19NT1ZFTUVOVDpVUERBVEUiLCJFTVBMT1lFRTpERUxFVEUiLCJFTVBMT1lFRTpDUkVBVEUiLCJXQVJFSE9VU0U6Q1JFQVRFIiwiREVQQVJUTUVOVDpDUkVBVEUiLCJDT01QQU5ZOkRFTEVURSIsIlNUT0NLX0xFVkVMOkRFTEVURSIsIklURU06VVBEQVRFIiwiU1RPQ0tfTU9WRU1FTlQ6REVMRVRFIiwiREVQQVJUTUVOVDpSRUFEIiwiQ0FURUdPUlk6REVMRVRFIiwiSVRFTTpSRUFEIiwiR0VORVJBTDpBRE1JTiIsIldBUkVIT1VTRTpVUERBVEUiLCJQQVlNRU5UX1RFUk06VVBEQVRFIiwiQ1VSUkVOQ1k6VVBEQVRFIiwiUEFZTUVOVF9URVJNOlJFQUQiLCJTQUxFU19PUkRFUjpBQ0NFUFQiLCJVTklUOkRFTEVURSIsIlNUT0NLX01PVkVNRU5UOlJFQUQiLCJDQVRFR09SWTpSRUFEIiwiU1RPQ0tfTEVWRUw6UkVBRCIsIlNBTEVTX09SREVSOlVQREFURSIsIlRBWDpDUkVBVEUiLCJDVVJSRU5DWTpSRUFEIiwiQ1VSUkVOQ1k6Q1JFQVRFIiwiU0FMRVNfT1JERVI6UkVBRCIsIkRFUEFSVE1FTlQ6VVBEQVRFIiwiUEFZTUVOVF9URVJNOkRFTEVURSIsIkRFUEFSVE1FTlQ6REVMRVRFIiwiU0FMRVNfT1JERVI6REVMRVRFIiwiSVRFTTpDUkVBVEUiLCJTQUxFU19PUkRFUjpTRU5EIiwiQ09NUEFOWTpVUERBVEUiLCJTVE9DS19MRVZFTDpVUERBVEUiLCJDQVRFR09SWTpVUERBVEUiLCJCVVNJTkVTU19QQVJUTkVSOkNSRUFURSIsIlVOSVQ6UkVBRCIsIlVOSVQ6Q1JFQVRFIiwiRU1QTE9ZRUU6UkVBRCIsIklURU06REVMRVRFIiwiV0FSRUhPVVNFOkRFTEVURSIsIkNPTVBBTlk6Q1JFQVRFIiwiQ0FURUdPUlk6Q1JFQVRFIiwiU1RPQ0tfTEVWRUw6Q1JFQVRFIiwiQlVTSU5FU1NfUEFSVE5FUjpSRUFEIiwiVEFYOkRFTEVURSIsIldBUkVIT1VTRTpSRUFEIiwiVEFYOlJFQUQiLCJTQUxFU19PUkRFUjpDQU5DRUwiLCJDVVJSRU5DWTpERUxFVEUiLCJTVE9DS19NT1ZFTUVOVDpDUkVBVEUiXSwiYXV0aFZlcnNpb24iOjMsImlhdCI6MTc3MTY4NzA2NiwiZXhwIjoxNzcxNjkwNjY2fQ.8aG52ChbcfMIsSY26R3H6-qwrrtBwyZrrwxGyGM7DoY
@refreshToken = eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJhZjNmZTcwZi01YTJjLTRhMmUtODBlZC03ZjlmZGJmNmIwNTQiLCJ0eXBlIjoicmVmcmVzaCIsImF1dGhWZXJzaW9uIjoyLCJpYXQiOjE3NzE2ODYwMjQsImV4cCI6MTc3MjI5MDgyNH0.wfcKV4c824RwR-C-kVJXq-OL2VDH2dujtS1_KMEzQAE

### 2.6 Refresh Token
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { refreshToken(refreshToken: {{refreshToken}}) { accessToken refreshToken expiresAt } }"
}


### 3.1 Create Company
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createCompany(input: { name: \"Acme Corp\" }) { id name } }"
}

> {%
    client.global.set("companyId", response.body.data.createCompany.id);
%}

### 3.2 Get Company by ID
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ company(id: \"{{companyId}}\") { id name departments { id name } businessPartners { id code name } paymentTerms { code name } taxes { code name rate } } }"
}

### 3.3 Get Companies by Tenant
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ companies(tenantId: \"{{tenantId}}\") { id name } }"
}


### 4.1 Create Currency
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createCurrency(input: { code: \"TRY\", name: \"Turkish Lira\", symbol: \"₺\", fractionDigits: 2 }) { code name symbol fractionDigits active } }"
}

### 4.2 Create Currency - USD
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createCurrency(input: { code: \"USD\", name: \"US Dollar\", symbol: \"$\", fractionDigits: 2 }) { code name symbol fractionDigits active } }"
}

### 4.3 Get Currencies
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ currencies { code name symbol fractionDigits active } }"
}

### 4.4 Get Currency by Code
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ currency(code: \"TRY\") { code name symbol fractionDigits active } }"
}

### 4.5 Create Unit - Piece
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createUnit(input: { code: \"PCS\", name: \"Piece\", type: \"QUANTITY\" }) { code name type active } }"
}

### 4.6 Create Unit - Kilogram
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createUnit(input: { code: \"KG\", name: \"Kilogram\", type: \"WEIGHT\" }) { code name type active } }"
}

### 4.7 Get Units
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ units { code name type active } }"
}

### 4.8 Get Unit by Code
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ unit(code: \"KG\") { code name type active } }"
}

### 4.9 Create Payment Term
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createPaymentTerm(input: { companyId: \"{{companyId}}\", code: \"NET30\", name: \"Net 30 Days\", dueDays: 30 }) { code name dueDays active company { id name } } }"
}

### 4.10 Get Payment Terms
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ paymentTerms(companyId: \"{{companyId}}\") { code name dueDays active company { id name } } }"
}

### 4.11 Create Tax
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createTax(input: { companyId: \"{{companyId}}\", code: \"KDV18\", name: \"KDV %18\", type: \"PERCENTAGE\", rate: 18 }) { code name type rate active company { id name } } }"
}

### 4.12 Get Taxes
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ taxes(companyId: \"{{companyId}}\") { code name type rate active company { id name } } }"
}


### 5.1 Create Department
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createDepartment(input: { name: \"Engineering\", companyId: \"{{companyId}}\" }) { id name company { id name } parent { id name } } }"
}

> {%
    client.global.set("departmentId", response.body.data.createDepartment.id);
%}

### 5.2 Create Sub-Department
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createDepartment(input: { name: \"Backend Team\", companyId: \"{{companyId}}\", parentId: \"{{departmentId}}\" }) { id name company { id name } parent { id name subDepartments { id name } } } }"
}

### 5.3 Get Department by ID
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ department(id: \"{{departmentId}}\") { id name company { id name } parent { id name } subDepartments { id name } employees { id name } } }"
}

### 5.4 Get Departments by Company
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ departments(companyId: \"{{companyId}}\") { id name company { id name } parent { id name } subDepartments { id name } employees { id name } } }"
}


### 6.1 Create Employee
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createEmployee(input: { name: \"John Doe\", departmentId: \"{{departmentId}}\" }) { id name department { id name } } }"
}

> {%
    client.global.set("employeeId", response.body.data.createEmployee.id);
%}

### 6.2 Get Employee by ID
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ employee(id: \"{{employeeId}}\") { id name department { id name company { id name } } } }"
}

### 6.3 Get Employees by Department
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ employees(departmentId: \"{{departmentId}}\") { id name department { id name } } }"
}


### 7.1 Create Business Partner (Customer)
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createBusinessPartner(input: { companyId: \"{{companyId}}\", code: \"CUST-001\", name: \"ABC Trading\", roles: [\"CUSTOMER\"], taxNumber: \"1234567890\" }) { id code name roles taxNumber active company { id name } } }"
}

> {%
    client.global.set("bpId", response.body.data.createBusinessPartner.id);
%}

### 7.2 Create Business Partner (Vendor)
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createBusinessPartner(input: { companyId: \"{{companyId}}\", code: \"VEND-001\", name: \"XYZ Supplies\", roles: [\"VENDOR\"], taxNumber: \"9876543210\" }) { id code name roles taxNumber active company { id name } } }"
}

### 7.3 Get Business Partner by ID
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ businessPartner(id: \"{{bpId}}\") { id code name roles taxNumber active company { id name } } }"
}

### 7.4 Get Business Partners by Company
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ businessPartners(companyId: \"{{companyId}}\") { id code name roles taxNumber active company { id name } } }"
}


### 8.1 Create Warehouse
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createWarehouse(input: { companyId: \"{{companyId}}\", code: \"WH-MAIN\", name: \"Main Warehouse\" }) { id companyId code name active company { id name } } }"
}

> {%
    client.global.set("warehouseId", response.body.data.createWarehouse.id);
%}

### 8.2 Create Warehouse 2
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createWarehouse(input: { companyId: \"{{companyId}}\", code: \"WH-SEC\", name: \"Secondary Warehouse\" }) { id code name active } }"
}

### 8.3 Get Warehouse by ID
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ warehouse(id: \"{{warehouseId}}\") { id companyId code name active company { id name } } }"
}

### 8.4 Get Warehouses by Company
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ warehouses(companyId: \"{{companyId}}\") { id code name active company { id name } } }"
}

### 8.5 Rename Warehouse
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { renameWarehouse(input: { warehouseId: \"{{warehouseId}}\", name: \"Main Warehouse (Updated)\" }) { id code name active } }"
}

### 8.6 Deactivate Warehouse
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { deactivateWarehouse(warehouseId: \"{{warehouseId}}\") { id code name active } }"
}

### 8.7 Activate Warehouse
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { activateWarehouse(warehouseId: \"{{warehouseId}}\") { id code name active } }"
}


### 9.1 Create Category
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createCategory(input: { companyId: \"{{companyId}}\", name: \"Electronics\" }) { id companyId name parentCategoryId active company { id name } parentCategory { id name } } }"
}

> {%
    client.global.set("categoryId", response.body.data.createCategory.id);
%}

### 9.2 Create Sub-Category
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createCategory(input: { companyId: \"{{companyId}}\", name: \"Smartphones\", parentCategoryId: \"{{categoryId}}\" }) { id name parentCategoryId active parentCategory { id name subCategories { id name } } } }"
}

> {%
    client.global.set("subCategoryId", response.body.data.createCategory.id);
%}

### 9.3 Get Category by ID
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ category(id: \"{{categoryId}}\") { id companyId name parentCategoryId active company { id name } parentCategory { id name } subCategories { id name active } } }"
}

### 9.4 Get Categories by Company
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ categories(companyId: \"{{companyId}}\") { id name parentCategoryId active parentCategory { id name } subCategories { id name active } } }"
}

### 9.5 Rename Category
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { renameCategory(input: { categoryId: \"{{categoryId}}\", name: \"Consumer Electronics\" }) { id name active } }"
}

### 9.6 Deactivate Category
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { deactivateCategory(categoryId: \"{{subCategoryId}}\") { id name active } }"
}

### 9.7 Activate Category
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { activateCategory(categoryId: \"{{subCategoryId}}\") { id name active } }"
}


### 10.1 Create Item (Physical)
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createItem(input: { companyId: \"{{companyId}}\", code: \"ITEM-001\", name: \"iPhone 15 Pro\", type: \"PHYSICAL\", unitCode: \"PCS\", categoryId: \"{{subCategoryId}}\", allowNegativeStock: false }) { id companyId code name type unitCode categoryId allowNegativeStock active company { id name } category { id name } } }"
}

> {%
    client.global.set("itemId", response.body.data.createItem.id);
%}

### 10.2 Create Item (Service)
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createItem(input: { companyId: \"{{companyId}}\", code: \"SVC-001\", name: \"Installation Service\", type: \"SERVICE\", unitCode: \"PCS\" }) { id code name type unitCode active } }"
}

### 10.3 Get Item by ID
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ item(id: \"{{itemId}}\") { id companyId code name type unitCode categoryId allowNegativeStock active company { id name } category { id name parentCategory { id name } } } }"
}

### 10.4 Get Items by Company
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ items(companyId: \"{{companyId}}\") { id code name type unitCode categoryId allowNegativeStock active category { id name } } }"
}

### 10.5 Update Item
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { updateItem(input: { itemId: \"{{itemId}}\", name: \"iPhone 15 Pro Max\", unitCode: \"PCS\", categoryId: \"{{subCategoryId}}\" }) { id code name unitCode categoryId active category { id name } } }"
}

### 10.6 Deactivate Item
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { deactivateItem(itemId: \"{{itemId}}\") { id code name active } }"
}

### 10.7 Activate Item
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { activateItem(itemId: \"{{itemId}}\") { id code name active } }"
}


### 11.1 Adjust Stock (+100)
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { adjustStock(input: { itemId: \"{{itemId}}\", warehouseId: \"{{warehouseId}}\", adjustment: 100 }) { id companyId itemId warehouseId quantityOnHand quantityReserved quantityAvailable reorderPoint allowNegativeStock item { id code name } warehouse { id code name } company { id name } } }"
}

> {%
    client.global.set("stockLevelId", response.body.data.adjustStock.id);
%}

### 11.2 Reserve Stock (20)
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { reserveStock(input: { itemId: \"{{itemId}}\", warehouseId: \"{{warehouseId}}\", quantity: 20, referenceId: \"SO-001\" }) { id quantityOnHand quantityReserved quantityAvailable item { id code name } warehouse { id code name } } }"
}

### 11.3 Release Reservation (5)
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { releaseReservation(input: { itemId: \"{{itemId}}\", warehouseId: \"{{warehouseId}}\", quantity: 5, referenceId: \"SO-001\" }) { id quantityOnHand quantityReserved quantityAvailable item { id code name } warehouse { id code name } } }"
}

### 11.4 Set Reorder Point
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { setReorderPoint(input: { stockLevelId: \"{{stockLevelId}}\", reorderPoint: 25 }) { id quantityOnHand quantityReserved quantityAvailable reorderPoint } }"
}

### 11.5 Get Stock Level by ID
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ stockLevel(id: \"{{stockLevelId}}\") { id companyId itemId warehouseId quantityOnHand quantityReserved quantityAvailable reorderPoint allowNegativeStock item { id code name type } warehouse { id code name } company { id name } } }"
}

### 11.6 Get Stock Levels by Warehouse
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ stockLevelsByWarehouse(warehouseId: \"{{warehouseId}}\") { id itemId warehouseId quantityOnHand quantityReserved quantityAvailable reorderPoint item { id code name } warehouse { id code name } } }"
}

### 11.7 Get Stock Levels by Item
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ stockLevelsByItem(itemId: \"{{itemId}}\") { id itemId warehouseId quantityOnHand quantityReserved quantityAvailable reorderPoint item { id code name } warehouse { id code name } } }"
}


### 12.1 Record Stock Movement (RECEIPT)
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { recordStockMovement(input: { companyId: \"{{companyId}}\", itemId: \"{{itemId}}\", warehouseId: \"{{warehouseId}}\", movementType: \"RECEIPT\", quantity: 50, referenceType: \"PURCHASE_ORDER\", referenceId: \"PO-001\", note: \"Initial stock receipt\", movementDate: \"2026-02-21\" }) { id companyId itemId warehouseId movementType quantity referenceType referenceId note movementDate createdAt item { id code name } warehouse { id code name } company { id name } } }"
}

> {%
    client.global.set("movementId", response.body.data.recordStockMovement.id);
%}

### 12.2 Record Stock Movement (ISSUE)
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { recordStockMovement(input: { companyId: \"{{companyId}}\", itemId: \"{{itemId}}\", warehouseId: \"{{warehouseId}}\", movementType: \"ISSUE\", quantity: 10, referenceType: \"SALES_ORDER\", referenceId: \"SO-001\", note: \"Shipped to customer\" }) { id movementType quantity referenceType referenceId note movementDate item { id code name } warehouse { id code name } } }"
}

### 12.3 Get Stock Movements by Warehouse
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ stockMovementsByWarehouse(warehouseId: \"{{warehouseId}}\") { id itemId warehouseId movementType quantity referenceType referenceId note movementDate createdAt item { id code name } warehouse { id code name } } }"
}

### 12.4 Get Stock Movements by Item
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ stockMovementsByItem(itemId: \"{{itemId}}\") { id itemId warehouseId movementType quantity referenceType referenceId note movementDate createdAt item { id code name } warehouse { id code name } } }"
}


### 13.1 Create Sales Order
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createSalesOrder(input: { companyId: \"{{companyId}}\", customerId: \"{{bpId}}\", currencyCode: \"TRY\", paymentTermCode: \"NET30\", orderDate: \"2026-02-21\" }) { id companyId orderNumber orderDate customerId currencyCode paymentTermCode status fulfillmentStatus invoicingStatus subtotal taxTotal total lines { id } company { id name } customer { id code name } } }"
}

> {%
    client.global.set("salesOrderId", response.body.data.createSalesOrder.id);
%}

###
@salesOrderId = acfadc27-b88e-42a9-9c82-b82ac7d034aa

### 13.2 Add Sales Order Line 1
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { addSalesOrderLine(input: { orderId: \"{{salesOrderId}}\", itemId: \"ITEM-001\", itemDescription: \"iPhone 15 Pro Max\", unitCode: \"PCS\", quantity: 5, unitPrice: 45000, taxCode: \"KDV18\" }) { id orderNumber subtotal taxTotal total lines { id sequence itemId itemDescription unitCode quantity unitPrice taxCode taxRate lineTotal taxAmount lineTotalWithTax } } }"
}

> {%
    client.global.set("salesLineId", response.body.data.addSalesOrderLine.lines[0].id);
%}

### 13.3 Add Sales Order Line 2
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { addSalesOrderLine(input: { orderId: \"{{salesOrderId}}\", itemId: \"SVC-001\", itemDescription: \"Installation Service\", unitCode: \"PCS\", quantity: 1, unitPrice: 5000, taxCode: \"KDV18\" }) { id orderNumber subtotal taxTotal total lines { id sequence itemDescription quantity unitPrice lineTotal taxAmount lineTotalWithTax } } }"
}

### 13.4 Update Sales Order Line
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { updateSalesOrderLine(input: { orderId: \"{{salesOrderId}}\", lineId: \"{{salesLineId}}\", quantity: 10, unitPrice: 42000 }) { id orderNumber subtotal taxTotal total lines { id sequence quantity unitPrice lineTotal taxAmount lineTotalWithTax } } }"
}

### 13.5 Update Sales Order Header
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { updateSalesOrderHeader(input: { orderId: \"{{salesOrderId}}\", orderDate: \"2026-02-22\", expiryDate: \"2026-03-22\", paymentTermCode: \"NET30\", shippingAddress: { addressLine1: \"123 Main St\", city: \"Istanbul\", postalCode: \"34000\", countryCode: \"TR\" } }) { id orderDate expiryDate paymentTermCode shippingAddress { addressLine1 city postalCode countryCode } } }"
}

### 13.6 Get Sales Order by ID
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ salesOrder(id: \"{{salesOrderId}}\") { id companyId orderNumber orderDate expiryDate customerId currencyCode paymentTermCode shippingAddress { addressLine1 addressLine2 city stateOrProvince postalCode countryCode } status fulfillmentStatus invoicingStatus invoicedAmount subtotal taxTotal total lines { id sequence itemId itemDescription unitCode quantity unitPrice taxCode taxRate lineTotal taxAmount lineTotalWithTax } company { id name } customer { id code name roles } } }"
}

### 13.7 Get Sales Orders by Company
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ salesOrders(companyId: \"{{companyId}}\") { id orderNumber orderDate status subtotal total customer { id name } company { id name } lines { id itemDescription quantity lineTotal } } }"
}


### 14.1 Update KDV rate from 18 → 20 (DRAFT orders auto-recalculate via event)
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { updateTaxRate(input: { companyId: \"{{companyId}}\", taxCode: \"KDV18\", newRate: 20 }) { code name type rate active } }"
}

### 14.2 Verify DRAFT sales order totals recalculated with new rate
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ salesOrder(id: \"{{salesOrderId}}\") { id orderNumber status subtotal taxTotal total lines { id itemDescription taxCode taxRate lineTotal taxAmount lineTotalWithTax } } }"
}

### 14.3 Revert KDV rate back to 18
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { updateTaxRate(input: { companyId: \"{{companyId}}\", taxCode: \"KDV18\", newRate: 18 }) { code name type rate active } }"
}


### 15.1 Send Sales Order
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { sendSalesOrder(orderId: \"{{salesOrderId}}\") { id orderNumber status } }"
}

### 15.2 Accept Sales Order
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { acceptSalesOrder(orderId: \"{{salesOrderId}}\") { id orderNumber status } }"
}

### 15.3 Confirm Sales Order
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { confirmSalesOrder(orderId: \"{{salesOrderId}}\") { id orderNumber status } }"
}

### 15.4 Remove Sales Order Line (create new order first for this test)
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
"query": "mutation { removeSalesOrderLine(orderId: \"{{salesOrderId}}\", lineId: \"{{salesLineId}}\") { id orderNumber lines { id sequence } } }"
}

### 15.5 Cancel Sales Order (create new order first for this test)
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
"query": "mutation { cancelSalesOrder(input: { orderId: \"{{salesOrderId}}\", reason: \"Customer request\" }) { id orderNumber status } }"
}


### 16.1 Create Delivery Order (from confirmed sales order)
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createDeliveryOrder(input: { companyId: \"{{companyId}}\", salesOrderId: \"{{salesOrderId}}\", salesOrderNumber: \"SO-2026-000001\", customerId: \"{{bpId}}\", addressLine1: \"123 Main St\", city: \"Istanbul\", postalCode: \"34000\", countryCode: \"TR\", lines: [{ salesOrderLineId: \"{{salesLineId}}\", itemId: \"{{itemId}}\", itemDescription: \"Test Item\", unitCode: \"PCS\", orderedQty: 10 }] }) { id number status salesOrderId salesOrderNumber lines { id salesOrderLineId itemId orderedQty shippedQty remainingQty } company { id name } salesOrder { id orderNumber } } }"
}

> {%
    client.global.set("deliveryOrderId", response.body.data.createDeliveryOrder.id);
    var lines = response.body.data.createDeliveryOrder.lines;
    if (lines && lines.length > 0) {
        client.global.set("doLineId", lines[0].id);
    }
%}

### 16.2 Get Delivery Order by ID
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ deliveryOrder(id: \"{{deliveryOrderId}}\") { id number status salesOrderId salesOrderNumber customerId shippingAddress { addressLine1 city countryCode } lines { id itemId orderedQty shippedQty remainingQty } } }"
}

### 16.3 Get Delivery Orders by Company
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ deliveryOrders(companyId: \"{{companyId}}\") { id number status salesOrderId } }"
}

### 17.1 Create Shipment
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createShipment(input: { companyId: \"{{companyId}}\", deliveryOrderId: \"{{deliveryOrderId}}\", salesOrderId: \"{{salesOrderId}}\", warehouseId: \"{{warehouseId}}\", addressLine1: \"123 Main St\", city: \"Istanbul\", postalCode: \"34000\", countryCode: \"TR\", lines: [{ deliveryOrderLineId: \"{{doLineId}}\", itemId: \"{{itemId}}\", itemDescription: \"Test Item\", unitCode: \"PCS\", quantity: 10 }] }) { id number status deliveryOrderId warehouseId lines { id deliveryOrderLineId itemId quantity } company { id name } deliveryOrder { id number } warehouse { id code name } } }"
}

> {%
    client.global.set("shipmentId", response.body.data.createShipment.id);
    var lines = response.body.data.createShipment.lines;
    if (lines && lines.length > 0) {
        client.global.set("shipmentLineId", lines[0].id);
    }
%}

### 17.2 Set Tracking Info
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { setShipmentTrackingInfo(input: { shipmentId: \"{{shipmentId}}\", carrierName: \"DHL\", trackingNumber: \"TRK-123456\" }) { id number trackingNumber carrierName status } }"
}

### 17.3 Dispatch Shipment
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { dispatchShipment(shipmentId: \"{{shipmentId}}\") { id number status dispatchedAt trackingNumber carrierName } }"
}

### 17.4 Deliver Shipment (also updates DeliveryOrder shippedQty)
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { deliverShipment(shipmentId: \"{{shipmentId}}\") { id number status deliveredAt lines { id itemId quantity } } }"
}

### 17.5 Get Shipment by ID (verify status + nested resolvers)
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ shipment(id: \"{{shipmentId}}\") { id number status trackingNumber carrierName dispatchedAt deliveredAt shippingAddress { addressLine1 city countryCode } lines { id deliveryOrderLineId itemId quantity } company { id name } deliveryOrder { id number status lines { id orderedQty shippedQty remainingQty } } warehouse { id code name } } }"
}

### 17.6 Get Shipments by Company
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ shipments(companyId: \"{{companyId}}\") { id number status deliveryOrderId } }"
}

### 17.7 Verify DeliveryOrder completed (shippedQty updated)
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ deliveryOrder(id: \"{{deliveryOrderId}}\") { id number status lines { id orderedQty shippedQty remainingQty } } }"
}

### 18.1 Create Shipment Return
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createShipmentReturn(input: { companyId: \"{{companyId}}\", shipmentId: \"{{shipmentId}}\", salesOrderId: \"{{salesOrderId}}\", warehouseId: \"{{warehouseId}}\", reason: \"Damaged items\", lines: [{ shipmentLineId: \"{{shipmentLineId}}\", itemId: \"{{itemId}}\", itemDescription: \"Test Item\", unitCode: \"PCS\", quantity: 2, lineReason: \"Box crushed\" }] }) { id number status reason shipmentId warehouseId lines { id shipmentLineId itemId quantity lineReason } company { id name } shipment { id number } } }"
}

> {%
    client.global.set("shipmentReturnId", response.body.data.createShipmentReturn.id);
%}

### 18.2 Get Shipment Return by ID
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ shipmentReturn(id: \"{{shipmentReturnId}}\") { id number status reason receivedAt lines { id shipmentLineId itemId quantity lineReason } } }"
}

### 18.3 Get Shipment Returns by Company
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ shipmentReturns(companyId: \"{{companyId}}\") { id number status reason } }"
}

### 18.4 Receive Shipment Return
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { receiveShipmentReturn(shipmentReturnId: \"{{shipmentReturnId}}\") { id number status receivedAt } }"
}

### 18.5 Complete Shipment Return
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { completeShipmentReturn(shipmentReturnId: \"{{shipmentReturnId}}\") { id number status } }"
}

### 18.6 Cancel Shipment Return (create new return for this test)
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
"query": "mutation { cancelShipmentReturn(shipmentReturnId: \"NEW_RETURN_ID\") { id number status } }"
}

### 18.7 Cancel Delivery Order (create new DO for this test)
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
"query": "mutation { cancelDeliveryOrder(input: { deliveryOrderId: \"NEW_DO_ID\", reason: \"No longer needed\" }) { id number status } }"
}

### 19.1 Logout
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { logout }"
}

### ═══════════════════════════════════════════════════════════════
### 20. FINANCE MODULE
### ═══════════════════════════════════════════════════════════════

### 20.1 Create Account (Revenue)
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createAccount(input: { companyId: \"{{companyId}}\", code: \"600\", name: \"Sales Revenue\", type: \"REVENUE\", nature: \"CREDIT_NORMAL\" }) { id code name type nature active company { id name } } }"
}

> {%
    client.global.set("revenueAccountId", response.body.data.createAccount.id);
%}

### 20.2 Create Account (Accounts Receivable)
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createAccount(input: { companyId: \"{{companyId}}\", code: \"120\", name: \"Accounts Receivable\", type: \"ASSET\", nature: \"DEBIT_NORMAL\" }) { id code name type nature active } }"
}

> {%
    client.global.set("arAccountId", response.body.data.createAccount.id);
%}

### 20.3 Create Account (Tax Payable)
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createAccount(input: { companyId: \"{{companyId}}\", code: \"391\", name: \"Tax Payable\", type: \"LIABILITY\", nature: \"CREDIT_NORMAL\" }) { id code name type nature active } }"
}

> {%
    client.global.set("taxAccountId", response.body.data.createAccount.id);
%}

### 20.4 Create Account (Cash)
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createAccount(input: { companyId: \"{{companyId}}\", code: \"100\", name: \"Cash\", type: \"ASSET\", nature: \"DEBIT_NORMAL\" }) { id code name type nature active } }"
}

> {%
    client.global.set("cashAccountId", response.body.data.createAccount.id);
%}

### 20.5 Create Account (Expense)
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createAccount(input: { companyId: \"{{companyId}}\", code: \"770\", name: \"Office Supplies\", type: \"EXPENSE\", nature: \"DEBIT_NORMAL\" }) { id code name type nature active } }"
}

> {%
    client.global.set("expenseAccountId", response.body.data.createAccount.id);
%}

### 20.6 Get Accounts
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ accounts(companyId: \"{{companyId}}\") { id code name type nature active } }"
}

### 20.7 Get Account by ID
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ account(id: \"{{revenueAccountId}}\") { id code name type nature active company { id name } } }"
}

### ─── Accounting Period ───

### 21.1 Create Accounting Period (Monthly)
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createAccountingPeriod(input: { companyId: \"{{companyId}}\", periodType: \"MONTHLY\", startDate: \"2026-02-01\", endDate: \"2026-02-28\" }) { id periodType startDate endDate status company { id name } } }"
}

> {%
    client.global.set("periodId", response.body.data.createAccountingPeriod.id);
%}

### 21.2 Get Accounting Periods
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ accountingPeriods(companyId: \"{{companyId}}\") { id periodType startDate endDate status } }"
}

### 21.3 Soft Close Accounting Period
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { softCloseAccountingPeriod(periodId: \"{{periodId}}\") { id status } }"
}

### 21.4 Reopen Accounting Period
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { reopenAccountingPeriod(periodId: \"{{periodId}}\") { id status } }"
}

### ─── Journal Entry ───

### 22.1 Create Journal Entry
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createJournalEntry(input: { companyId: \"{{companyId}}\", type: \"MANUAL\", entryDate: \"2026-02-21\", description: \"Test manual journal entry\", currencyCode: \"TRY\", lines: [ { accountId: \"{{arAccountId}}\", accountCode: \"120\", accountName: \"Accounts Receivable\", debitAmount: 1000.00, description: \"Debit AR\" }, { accountId: \"{{revenueAccountId}}\", accountCode: \"600\", accountName: \"Sales Revenue\", creditAmount: 1000.00, description: \"Credit Revenue\" } ] }) { id entryNumber type entryDate description status totalDebit totalCredit lines { id accountCode debitAmount creditAmount } company { id name } } }"
}

> {%
    client.global.set("journalEntryId", response.body.data.createJournalEntry.id);
%}

### 22.2 Get Journal Entry
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ journalEntry(id: \"{{journalEntryId}}\") { id entryNumber type status totalDebit totalCredit lines { id accountCode accountName debitAmount creditAmount } } }"
}

### 22.3 Get Journal Entries by Company
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ journalEntries(companyId: \"{{companyId}}\") { id entryNumber type status entryDate } }"
}

### 22.4 Post Journal Entry
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { postJournalEntry(entryId: \"{{journalEntryId}}\") { id entryNumber status } }"
}

### 22.5 Reverse Journal Entry
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { reverseJournalEntry(entryId: \"{{journalEntryId}}\", reason: \"Incorrect entry\") { id entryNumber type status description lines { id accountCode debitAmount creditAmount } } }"
}

> {%
    client.global.set("reversalEntryId", response.body.data.reverseJournalEntry.id);
%}

### ─── Sales Invoice ───

### 23.1 Create Sales Invoice
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createSalesInvoice(input: { companyId: \"{{companyId}}\", invoiceType: \"STANDARD\", customerId: \"{{bpId}}\", customerName: \"Test Customer\", invoiceDate: \"2026-02-21\", dueDate: \"2026-03-21\", currencyCode: \"TRY\", lines: [ { itemId: \"{{itemId}}\", itemDescription: \"Test Item\", unitCode: \"PCS\", quantity: 10, unitPrice: 100.00, taxCode: \"KDV18\", taxRate: 0.18, revenueAccountId: \"{{revenueAccountId}}\" } ] }) { id invoiceNumber invoiceType status invoiceDate dueDate subtotal taxTotal total paidAmount remainingAmount lines { id itemDescription quantity unitPrice lineTotal taxAmount lineTotalWithTax } company { id name } } }"
}

> {%
    client.global.set("salesInvoiceId", response.body.data.createSalesInvoice.id);
%}

### 23.2 Get Sales Invoice
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ salesInvoice(id: \"{{salesInvoiceId}}\") { id invoiceNumber invoiceType status subtotal taxTotal total paidAmount remainingAmount lines { id itemDescription quantity unitPrice } } }"
}

### 23.3 Get Sales Invoices by Company
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ salesInvoices(companyId: \"{{companyId}}\") { id invoiceNumber status total paidAmount } }"
}

### 23.4 Post Sales Invoice
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { postSalesInvoice(invoiceId: \"{{salesInvoiceId}}\") { id invoiceNumber status } }"
}

### ─── Payment ───

### 24.1 Create Payment
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createPayment(input: { companyId: \"{{companyId}}\", paymentType: \"RECEIVED\", invoiceId: \"{{salesInvoiceId}}\", customerId: \"{{bpId}}\", paymentDate: \"2026-02-21\", amount: 500.00, currencyCode: \"TRY\", paymentMethod: \"BANK_TRANSFER\", referenceNumber: \"TRF-001\" }) { id paymentNumber paymentType status amount paymentMethod referenceNumber company { id name } } }"
}

> {%
    client.global.set("paymentId", response.body.data.createPayment.id);
%}

### 24.2 Get Payment
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ payment(id: \"{{paymentId}}\") { id paymentNumber paymentType status amount paymentMethod } }"
}

### 24.3 Get Payments by Company
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ payments(companyId: \"{{companyId}}\") { id paymentNumber status amount } }"
}

### 24.4 Post Payment (triggers invoice paidAmount update)
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { postPayment(paymentId: \"{{paymentId}}\") { id paymentNumber status } }"
}

### 24.5 Verify Invoice Updated After Payment
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ salesInvoice(id: \"{{salesInvoiceId}}\") { id invoiceNumber status paidAmount remainingAmount total } }"
}

### 24.6 Create Second Payment (rest)
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createPayment(input: { companyId: \"{{companyId}}\", paymentType: \"RECEIVED\", invoiceId: \"{{salesInvoiceId}}\", customerId: \"{{bpId}}\", paymentDate: \"2026-02-22\", amount: 680.00, currencyCode: \"TRY\", paymentMethod: \"BANK_TRANSFER\", referenceNumber: \"TRF-002\" }) { id paymentNumber status } }"
}

> {%
    client.global.set("payment2Id", response.body.data.createPayment.id);
%}

### 24.7 Post Second Payment
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { postPayment(paymentId: \"{{payment2Id}}\") { id paymentNumber status } }"
}

### 24.8 Verify Invoice Fully Paid
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ salesInvoice(id: \"{{salesInvoiceId}}\") { id invoiceNumber status paidAmount remainingAmount total } }"
}

### ─── Credit Note ───

### 25.1 Create Credit Note
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createCreditNote(input: { companyId: \"{{companyId}}\", invoiceId: \"{{salesInvoiceId}}\", customerId: \"{{bpId}}\", creditNoteDate: \"2026-02-21\", currencyCode: \"TRY\", reason: \"Returned goods\", lines: [ { itemId: \"{{itemId}}\", itemDescription: \"Test Item\", unitCode: \"PCS\", quantity: 2, unitPrice: 100.00, taxCode: \"KDV18\", taxRate: 0.18 } ] }) { id creditNoteNumber status total appliedAmount reason lines { id itemDescription quantity unitPrice lineTotal taxAmount lineTotalWithTax } company { id name } } }"
}

> {%
    client.global.set("creditNoteId", response.body.data.createCreditNote.id);
%}

### 25.2 Get Credit Note
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ creditNote(id: \"{{creditNoteId}}\") { id creditNoteNumber status total appliedAmount lines { id itemDescription quantity } } }"
}

### 25.3 Get Credit Notes by Company
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ creditNotes(companyId: \"{{companyId}}\") { id creditNoteNumber status total } }"
}

### 25.4 Post Credit Note
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { postCreditNote(creditNoteId: \"{{creditNoteId}}\") { id creditNoteNumber status } }"
}

### 25.5 Apply Credit Note
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { applyCreditNote(creditNoteId: \"{{creditNoteId}}\", amount: 236.00) { id creditNoteNumber status appliedAmount total } }"
}

### ─── Expense ───

### 26.1 Create Expense
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createExpense(input: { companyId: \"{{companyId}}\", description: \"Office supplies purchase\", category: \"OFFICE\", submittedBy: \"admin\", expenseDate: \"2026-02-21\", amount: 250.00, currencyCode: \"TRY\", receiptReference: \"REC-001\", expenseAccountId: \"{{expenseAccountId}}\" }) { id expenseNumber description category status amount expenseDate company { id name } } }"
}

> {%
    client.global.set("expenseId", response.body.data.createExpense.id);
%}

### 26.2 Get Expense
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ expense(id: \"{{expenseId}}\") { id expenseNumber description status amount category submittedBy } }"
}

### 26.3 Get Expenses by Company
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ expenses(companyId: \"{{companyId}}\") { id expenseNumber description status amount } }"
}

### 26.4 Submit Expense
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { submitExpense(expenseId: \"{{expenseId}}\") { id expenseNumber status } }"
}

### 26.5 Approve Expense
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { approveExpense(expenseId: \"{{expenseId}}\", approverId: \"admin\") { id expenseNumber status approvedBy } }"
}

### 26.6 Post Expense
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { postExpense(expenseId: \"{{expenseId}}\") { id expenseNumber status } }"
}

### 26.7 Create Another Expense (for reject test)
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createExpense(input: { companyId: \"{{companyId}}\", description: \"Unnecessary travel expense\", category: \"TRAVEL\", submittedBy: \"admin\", expenseDate: \"2026-02-21\", amount: 5000.00, currencyCode: \"TRY\" }) { id expenseNumber status } }"
}

> {%
    client.global.set("expense2Id", response.body.data.createExpense.id);
%}

### 26.8 Submit and Reject Expense
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { submitExpense(expenseId: \"{{expense2Id}}\") { id status } }"
}

###
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { rejectExpense(expenseId: \"{{expense2Id}}\", reason: \"Budget exceeded\") { id status } }"
}

### 27.1 Cancel Sales Invoice (create a new one for this)
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createSalesInvoice(input: { companyId: \"{{companyId}}\", customerId: \"{{bpId}}\", customerName: \"Test\", invoiceDate: \"2026-02-21\", currencyCode: \"TRY\", lines: [ { itemDescription: \"Cancel Test\", quantity: 1, unitPrice: 50.00 } ] }) { id invoiceNumber status } }"
}

> {%
    client.global.set("cancelInvId", response.body.data.createSalesInvoice.id);
%}

###
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { cancelSalesInvoice(invoiceId: \"{{cancelInvId}}\", reason: \"Duplicate\") { id invoiceNumber status } }"
}

### 27.2 Cancel Payment
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createPayment(input: { companyId: \"{{companyId}}\", paymentType: \"RECEIVED\", paymentDate: \"2026-02-21\", amount: 100.00, currencyCode: \"TRY\", paymentMethod: \"CASH\" }) { id paymentNumber status } }"
}

> {%
    client.global.set("cancelPayId", response.body.data.createPayment.id);
%}

###
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { cancelPayment(paymentId: \"{{cancelPayId}}\", reason: \"Wrong amount\") { id paymentNumber status } }"
}


### ═══════════════════════════════════════════════════════════════
### 20. CRM — Contact
### ═══════════════════════════════════════════════════════════════

### 20.1 Create Contact (PERSON)
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createContact(input: { companyId: \"{{companyId}}\", contactType: \"PERSON\", firstName: \"John\", lastName: \"Doe\", email: \"john.doe@example.com\", phone: \"+905551234567\", source: \"WEB\", notes: \"Potential ERP customer\" }) { id companyId contactNumber contactType firstName lastName email phone status source notes company { id name } } }"
}

> {%
    client.global.set("crmContactId", response.body.data.createContact.id);
%}

### 20.2 Create Contact (COMPANY)
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createContact(input: { companyId: \"{{companyId}}\", contactType: \"COMPANY\", companyName: \"ABC Corp\", email: \"info@abccorp.com\", phone: \"+902121234567\", website: \"https://abccorp.com\", source: \"REFERRAL\" }) { id contactNumber contactType companyName email phone website status source } }"
}

### 20.3 Get Contact by ID
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ crmContact(id: \"{{crmContactId}}\") { id contactNumber contactType firstName lastName email phone status source company { id name } } }"
}

### 20.4 List Contacts by Company
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ crmContacts(companyId: \"{{companyId}}\") { id contactNumber contactType firstName lastName companyName email status source } }"
}

### ═══════════════════════════════════════════════════════════════
### 21. CRM — Lead
### ═══════════════════════════════════════════════════════════════

### 21.1 Create Lead
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createLead(input: { companyId: \"{{companyId}}\", title: \"ABC Corp ERP Project\", contactId: \"{{crmContactId}}\", source: \"WEB\", estimatedValue: 50000.00, expectedCloseDate: \"2026-06-01\", notes: \"Large ERP implementation\" }) { id companyId leadNumber title contactId status source estimatedValue expectedCloseDate notes contact { id firstName lastName } company { id name } } }"
}

> {%
    client.global.set("leadId", response.body.data.createLead.id);
%}

### 21.2 Get Lead by ID
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ lead(id: \"{{leadId}}\") { id leadNumber title contactId status source estimatedValue expectedCloseDate contact { id firstName lastName email } company { id name } } }"
}

### 21.3 List Leads by Company
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ leads(companyId: \"{{companyId}}\") { id leadNumber title status source estimatedValue } }"
}

### ═══════════════════════════════════════════════════════════════
### 22. CRM — Opportunity
### ═══════════════════════════════════════════════════════════════

### 22.1 Create Opportunity
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createOpportunity(input: { companyId: \"{{companyId}}\", title: \"ABC Corp ERP Deal\", contactId: \"{{crmContactId}}\", leadId: \"{{leadId}}\", expectedValue: 75000.00, currencyCode: \"TRY\", expectedCloseDate: \"2026-07-01\", notes: \"Upgraded from lead\" }) { id companyId opportunityNumber title contactId leadId stage probability expectedValue currencyCode expectedCloseDate notes contact { id firstName lastName } company { id name } } }"
}

> {%
    client.global.set("opportunityId", response.body.data.createOpportunity.id);
%}

### 22.2 Get Opportunity by ID
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ opportunity(id: \"{{opportunityId}}\") { id opportunityNumber title stage probability expectedValue currencyCode expectedCloseDate contact { id firstName lastName } company { id name } } }"
}

### 22.3 List Opportunities by Company
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ opportunities(companyId: \"{{companyId}}\") { id opportunityNumber title stage probability expectedValue currencyCode } }"
}

### ═══════════════════════════════════════════════════════════════
### 23. CRM — Quote
### ═══════════════════════════════════════════════════════════════

### 23.1 Create Quote
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createQuote(input: { companyId: \"{{companyId}}\", opportunityId: \"{{opportunityId}}\", contactId: \"{{crmContactId}}\", quoteDate: \"2026-02-22\", expiryDate: \"2026-03-22\", currencyCode: \"TRY\", paymentTermCode: \"NET30\", notes: \"Initial proposal\" }) { id companyId quoteNumber opportunityId contactId quoteDate expiryDate currencyCode paymentTermCode status version subtotal taxTotal total notes lines { id } contact { id firstName lastName } opportunity { id title stage } company { id name } } }"
}

> {%
    client.global.set("quoteId", response.body.data.createQuote.id);
%}

### 23.2 Get Quote by ID
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ quote(id: \"{{quoteId}}\") { id quoteNumber status version subtotal taxTotal total lines { id itemDescription quantity unitPrice lineTotal } contact { id firstName lastName } opportunity { id title } company { id name } } }"
}

### 23.3 List Quotes by Company
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ quotes(companyId: \"{{companyId}}\") { id quoteNumber status version total } }"
}

### ═══════════════════════════════════════════════════════════════
### 24. CRM — Activity
### ═══════════════════════════════════════════════════════════════

### 24.1 Create Activity (CALL for Lead)
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createActivity(input: { companyId: \"{{companyId}}\", activityType: \"CALL\", subject: \"Initial discovery call with ABC Corp\", relatedEntityType: \"LEAD\", relatedEntityId: \"{{leadId}}\", scheduledAt: \"2026-02-23T10:00:00\", description: \"Discuss ERP requirements\" }) { id companyId activityType subject status relatedEntityType relatedEntityId scheduledAt description company { id name } } }"
}

> {%
    client.global.set("activityId", response.body.data.createActivity.id);
%}

### 24.2 Create Activity (MEETING for Opportunity)
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "mutation { createActivity(input: { companyId: \"{{companyId}}\", activityType: \"MEETING\", subject: \"Demo presentation to ABC Corp\", relatedEntityType: \"OPPORTUNITY\", relatedEntityId: \"{{opportunityId}}\", scheduledAt: \"2026-02-25T14:00:00\", description: \"Full ERP demo\" }) { id activityType subject status relatedEntityType relatedEntityId scheduledAt description } }"
}

### 24.3 Get Activity by ID
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ activity(id: \"{{activityId}}\") { id activityType subject status relatedEntityType relatedEntityId scheduledAt description company { id name } } }"
}

### 24.4 List Activities by Company
POST http://localhost:8080/graphql
Content-Type: application/json
X-TENANT: TST
Authorization: Bearer {{token}}

{
  "query": "{ activities(companyId: \"{{companyId}}\") { id activityType subject status relatedEntityType relatedEntityId scheduledAt } }"
}
